{% extends "base.html"%}
{% block navbar %}
<nav class="navbar navbar-expand-sm navbar-dark fixed-top mb-5" id="containerNav">
    <div class="container-fluid" id="mainNav">
        <div class="navbar-header">
            <a id="navHome" class="navbar-brand" href="/login">
                <img id="navImg" src="../static/navLogo.jpeg" alt="" class="img-circle">&nbsp;Home
            </a>
        </div>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav text-uppercase ml-auto">
                <li class="nav-item">
                    <a class="nav-link pl-4 pr-4 other" href="/login">Classes</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link pl-4 pr-4 other" href="/fact">Homework</a>
                </li>
                <li class="nav-item mr-1 ml-1">
                    <div class="btn-group">
                        <img src="https://api.adorable.io/avatars/53/{{ session['email'] }}" alt="" class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="dropdown-menu dropdown-menu-right noDeco pb-0">
                            <a href="/clear" class="noDeco text-left" style="text-decoration: none;">
                                <button class="dropdown-item logBtn" type="button">Logout</button>
                            </a>
                        </div>
                    </div>
                </li>

            </ul>

        </div>
    </div>
</nav>
{% endblock %}

{%block content%}
<div class="container">
    <div class="row mt-5">
        <div class="col mt-4 class-head">
            <div class="row align-items-start">
                <div class="col">
                    <h2 id="navHeader3" class="mt-4 ml-5"><b>{{ className }}</b></h2>
                </div>
            </div>
            <div class="row align-items-center sizes"></div>
            <div class="row align-items-end">

                {% if isTeacher %}
                <div class="col text-right">
                    <h3 id="navHeader5" class="mb-2 mr-5">Instructor: {{ teacherName }} <b>(You)</b></h3>
                </div>
                {% else %}
                <div class="col text-right">
                    <h3 id="navHeader5" class="mb-2 mr-5">Instructor: {{ teacherName }}</h3>
                </div>
                {% endif %}

            </div>
        </div>
    </div>
    <ul class="nav nav-tabs justify-content-center mt-2" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#posts" role="tab" aria-controls="home" aria-selected="true">Posts</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#roster" role="tab" aria-controls="profile" aria-selected="false">People</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#clip" role="tab" aria-controls="clip" aria-selected="false">Invite Code</a>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="posts" role="tabpanel" aria-labelledby="post-tab">
            {% if isTeacher %}
            {% if posts|length == 0 %}
            <div class="row mt-4">
                <div class="col mt-3 mr-4 ml-4">
                    <p style="color: red;">You have no posts, go make one!</p>
                </div>
            </div>
            {% endif %}
            {% for i in posts %}
            <div class="row mt-4">
                <div class="col pl-0 pr-0">
                    <div class="card cardOut">
                        <div class="card-header pt-1 pb-1 pl-2">
                            <div class="row">
                                <div class="col-sm-1 pr-0 text-center">
                                    <img id="dropMenu2" src="https://api.adorable.io/avatars/48/{{ session['email'] }}" alt="">
                                </div>
                                <div class="col-sm-9 pl-0">
                                    <p class="mb-0 fam">You</p>
                                    <p class="mb-0 text-secondary">{{ i[2] }}</p>
                                </div>
                                <div class="col-sm-2 pr-0">
                                    <button class="btn btn-primary classBtns">Grades</button>
                                </div>

                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Description</h5>
                            <p class="card-text"> tempora iusto. Sed itaque accusantium nulla repudiandae voluptas et.</p>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        {{i[4]}}<br>
                        Due: {{i[3]}} <br>
                        {% if isTeacher %}
                        {% set url = "/deletepost/" + i[0]|string %}
                        <a href={{url}}> Delete Post </a>
                        {% endif %}
                        {% if i[5] == 1 and not isTeacher %}
                        <form action = "/submitFile" method = "POST" enctype="multipart/form-data">
                            <input type="hidden" name="postID" value="{{i[0]}}">
                            <input type="file" name="file">
                            <input type="submit" value="Upload">
                        </form>
                        {% elif i[5] == 1 %}<br>
                        <button onclick="show({{i[0]}})">View Submissions</button>
                        <div id="{{i[0]}}" style="display:none;">
                            {% set uploads = getPostFiles(i[0]) %}
                            {% if uploads|length == 0 %}
                            No submissions yet.
                            {% else %}
                            {% for i in uploads %}
                            {{getName(i[1])}} Submitted: {{i[2]}} <a href="/viewFile/{{i[0]}}">View File</a>
                            {% endfor %}
                            {% endif %}
                        </div>
                        {% endif %}

                    </div>
                </div>
                {% endfor %}
                {% else %}
                {% if posts|length == 0 %}
                <div class="row mt-4">
                    <div class="col mt-3 mr-4 ml-4">
                        <p style="color: red;">Your teacher hasn't posted anything yet.</p>
                    </div>
                </div>
                {% endif %}
                {% endif %}
            </div>
            <!-- roster panel -->
            <div class="tab-pane fade" id="roster" role="tabpanel" aria-labelledby="roster-tab">
                <div class="row mr-1 ml-1">
                    <div class="col-md-1"></div>
                    <div class="col">
                        <h2 class="mt-4 mb-2 pb-1 text-mine btmBorder ml-1 mr-1"> &nbsp; Instructors</h2>
                    </div>
                    <div class="col-md-1"></div>
                </div>
                <div class="row mr-1 ml-1">
                    <div class="col-md-1"></div>
                    <div class="col ml-4 mr-4">
                        <div class="row">
                            <div class="col-sm-1 fit">
                                <img src="https://api.adorable.io/avatars/31/{{ session['email'] }}" class="round-Img ml-1 pl-2 pr-2 pt-2 pb-2" alt="Icon">
                            </div>
                            <div class="col special-margins">
                                <p class="mt-3">{{ teacherName }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <!-- students -->
                <div class="row mr-1 ml-1">
                    <div class="col-md-1"></div>
                    <div class="col">
                        <h2 class="mt-special mb-3 pb-1 text-mine btmBorder mr-1 ml-1"> &nbsp; Classmates</h2>
                    </div>
                    <div class="col-md-1"></div>
                </div>
                {% for i in classRoster %}
                <div class="row mr-1 ml-1">
                    <div class="col-md-1"></div>
                    <div class="col ml-4 mr-4 btmBorder2">
                        <div class="row">
                            <div class="col-sm-1 fit">
                                <img src="https://api.adorable.io/avatars/31/{{ getName(i) }}" class="round-Img ml-1 pl-2 pr-2 pt-2 pb-2" alt="Icon">
                            </div>
                            <div class="col special-margins">
                                <p class="mt-3">{{ getName(i) }}</p>
                            </div>
                            {% if isTeacher %}
                              {% set url = "/usergrades/" + classID|string + "/" + i|string %}
                              <a href={{url}}> Grades </a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>
                {% endfor %}
            </div>
            <div class="tab-pane fade" id="clip" role="tabpanel" aria-labelledby="contract-tab">
                <div class="row mr-3 ml-3 mt-2">
                    <div class="col mt-2 text-center">
                        <button id="clipBtn" class="btn btn-secondary" data-clipboard-text="{{ inviteCode }}">
                            Copy code ({{ inviteCode }})
                        </button>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-4"></div>
                    <div class="col-md-4">
                        <div id="alertTip" class="alert alert-success" style="display: none;">Copied to clipboard</div>
                    </div>
                    <div class="col-md-4"></div>
                </div>

            </div>
        </div>

    </div>
    <br>
    <br>
    <br>
    <h1>{{className}}</h1>
    Taught by {{teacherName}}<br>
    Invite Code: {{inviteCode}}<br>
    Weights:<br>
    <ul>
        {% for i in weights %}
        <li>
            {{i[0]}} : {{i[1]}}
        </li>
        {% endfor %}
    </ul>
    Roster:<br>
    <ul>
        {% for i in classRoster %}
        <li>
            {{getName(i)}}
        </li>
        {% endfor %}
    </ul>
    {% if isTeacher %}
    {% set url = "/makepost/" + classID|string %}
    <a href={{url}}> Make a Post </a> <br>
    {% set url = "/deleteclass/" + classID|string %}
    <a href={{url}}> Delete this Class </a> <br>
    {% endif %}
    Posts:<br>
    <ul>
        {% for i in posts %}
        <li>
            {{i[4]}} <br>
            Posted: {{i[2]}} <br>
            Due: {{i[3]}} <br>
            {% if i[5] == 1 and not isTeacher %}
            <form action = "/submitFile" method = "POST" enctype="multipart/form-data">
                <input type="hidden" name="postID" value="{{i[0]}}">
                <input type="file" name="file">
                <input type="submit" value="Upload">
            </form>
            {% elif i[5] == 1 %}
            <button onclick="show{{i[0]}}()">View Submissions</button>
            <div id="{{i[0]}}">
                {% set uploads = getPostFiles(i[0]) %}
                {% if uploads|length == 0 %}
                No submissions yet.
                {% else %}
                {% for i in uploads %}
                {{getName(i[1])}} Submitted: {{i[2]}} <a href="/viewFile/{{i[0]}}">View File</a>
                {% endfor %}
                {% endif %}
            </div>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="../static/clipboard.js-master/dist/clipboard.min.js"></script>
    <script src="../static/class.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.bundle.min.js"></script>
    {% endblock %}
